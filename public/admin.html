<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Admin Bingo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { background-color: #f0f8ff; font-family: Arial, sans-serif; }
    .container { max-width: 1200px; }
    .card { background-color: #ffffff; border: 1px solid #dee2e6; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
    button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    #winners, #players { list-style: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">Painel Admin Bingo</h1>
    
    <!-- Login se não auth -->
    <div id="login" class="card">
      <input type="password" id="password" placeholder="Senha Admin" class="form-control mb-2">
      <button onclick="login()">Entrar</button>
    </div>
    
    <div id="content" style="display:none;">
      <!-- Atribuir cartela -->
      <div class="card">
        <h3>Atribuir Cartela</h3>
        <input id="name" placeholder="Nome" class="form-control mb-2">
        <input id="phone" placeholder="Telefone" class="form-control mb-2">
        <input id="cardId" placeholder="ID Cartela" type="number" class="form-control mb-2">
        <button onclick="assignCard()">Atribuir</button>
      </div>
      
      <!-- Adicionar/Remover cartela -->
      <div class="card">
        <h3>Adicionar/Remover Cartela</h3>
        <input id="phoneMod" placeholder="Telefone" class="form-control mb-2">
        <input id="cardIdMod" placeholder="ID Cartela" type="number" class="form-control mb-2">
        <button onclick="addCard()">Adicionar</button>
        <button onclick="removeCard()">Remover</button>
      </div>
      
      <!-- Excluir -->
      <div class="card">
        <h3>Excluir</h3>
        <input id="phoneDel" placeholder="Telefone" class="form-control mb-2">
        <button onclick="deletePlayer()">Excluir por Telefone</button>
        <button onclick="deleteAll()">Excluir Todos</button>
      </div>
      
      <!-- Prêmio -->
      <div class="card">
        <h3>Atualizar Prêmio</h3>
        <input id="prize" placeholder="Prêmio Atual" class="form-control mb-2">
        <button onclick="updatePrize()">Atualizar</button>
      </div>
      
      <!-- Reiniciar -->
      <div class="card">
        <button onclick="restart()">Reiniciar Bingo</button>
      </div>
      
      <!-- Lista Jogadores -->
      <div class="card">
        <h3>Jogadores</h3>
        <ul id="players"></ul>
      </div>
      
      <!-- Vencedores -->
      <div class="card">
        <h3>Todos Vencedores</h3>
        <ul id="allWinners"></ul>
      </div>
      
      <!-- Números Sorteados -->
      <div class="card">
        <h3>Números Sorteados</h3>
        <div id="organized"></div>
        <p>Último: <span id="last"></span></p>
        <p>Prêmio: <span id="prizeDisplay"></span></p>
      </div>
    </div>
  </div>
  
  <script>
    const socket = io();
    
    function login() {
      fetch('/login', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ password: document.getElementById('password').value }) })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('content').style.display = 'block';
          } else alert('Senha errada');
        });
    }
    
    function assignCard() {
      const data = { name: document.getElementById('name').value, phone: document.getElementById('phone').value, cardId: parseInt(document.getElementById('cardId').value) };
      fetch('/assign-card', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
    }
    
    function addCard() {
      const data = { phone: document.getElementById('phoneMod').value, cardId: parseInt(document.getElementById('cardIdMod').value) };
      fetch('/add-card', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
    }
    
    function removeCard() {
      const data = { phone: document.getElementById('phoneMod').value, cardId: parseInt(document.getElementById('cardIdMod').value) };
      fetch('/remove-card', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
    }
    
    function deletePlayer() {
      const data = { phone: document.getElementById('phoneDel').value };
      fetch('/delete-player', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
    }
    
    function deleteAll() {
      fetch('/delete-all-players', { method: 'POST' });
    }
    
    function updatePrize() {
      const data = { prize: document.getElementById('prize').value };
      fetch('/update-prize', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
    }
    
    function restart() {
      fetch('/restart', { method: 'POST' });
    }
    
    socket.on('admin-update', data => {
      // Atualiza jogadores
      const playersUl = document.getElementById('players');
      playersUl.innerHTML = '';
      data.players.forEach(p => {
        const li = document.createElement('li');
        li.innerHTML = `${p.name} - ${p.phone} - Cartelas: ${p.cardIds.join(', ')} <button onclick="navigator.clipboard.writeText('${location.origin}${p.link}')">Copiar Link</button>`;
        playersUl.appendChild(li);
      });
      
      // Atualiza vencedores
      const winnersUl = document.getElementById('allWinners');
      winnersUl.innerHTML = '';
      data.allWinners.forEach(w => {
        const li = document.createElement('li');
        li.innerHTML = `ID: ${w.cardId} - ${w.phone} - ${w.name} - ${new Date(w.time).toLocaleString()}`;
        winnersUl.appendChild(li);
      });
      
      // Atualiza números
      updateNumbers(data);
    });
    
    function updateNumbers(data) {
      const orgDiv = document.getElementById('organized');
      orgDiv.innerHTML = '';
      for (let letter in data.organized) {
        orgDiv.innerHTML += `<p>${letter} (${letter === 'B' ? '1-15' : letter === 'I' ? '16-30' : letter === 'N' ? '31-45' : letter === 'G' ? '46-60' : '61-75'}): ${data.organized[letter].join(', ')}</p>`;
      }
      document.getElementById('last').innerText = data.last || 'Nenhum';
      document.getElementById('prizeDisplay').innerText = data.prize;
    }
  </script>
</body>
</html>
