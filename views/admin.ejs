<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Painel Admin - Bingo</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="/socket.io/socket.io.js"></script>
<style>
body { background-color: #f7f9fc; }
h1 { color: #0d6efd; margin-bottom: 30px; }
.table td, .table th { vertical-align: middle; text-align: center; }
.btn-copy { cursor: pointer; }
.vencedor-msg { color: green; font-weight: bold; }
.form-control.w-auto { display: inline-block; width: auto; }
.section-title { color: #0d6efd; margin-top: 40px; }
</style>
</head>
<body class="p-4">

<div class="container">

<h1>Painel Admin - Bingo</h1>

<!-- Controle de Sorteio -->
<div class="mb-4">
  <h3 class="section-title">Controle de Sorteio</h3>
  <p><strong>Últimos números sorteados:</strong> <%= ultimosNumeros && ultimosNumeros.length ? ultimosNumeros.join(', ') : '-' %></p>
  <p><strong>Prêmio atual:</strong> <%= premioAtual || '-' %></p>

  <form action="/sortear" method="POST" class="mb-2 d-inline-block">
    <button type="submit" class="btn btn-primary">Sortear Número Automático</button>
  </form>

  <form action="/premio" method="POST" class="mb-2 d-inline-block">
    <input type="text" name="premio" placeholder="Atualizar prêmio" class="form-control w-auto" required>
    <button type="submit" class="btn btn-warning">Atualizar Prêmio</button>
  </form>

  <form action="/reiniciar" method="POST" class="mb-2 d-inline-block">
    <button type="submit" class="btn btn-danger">Reiniciar Bingo</button>
  </form>
</div>

<!-- Atribuir Cartela -->
<div class="mb-4">
  <h3 class="section-title">Atribuir Cartela</h3>
  <form action="/atribuir" method="POST" class="mb-3 d-flex gap-2 flex-wrap">
    <input type="number" name="id" placeholder="ID Cartela" class="form-control w-auto" required>
    <input type="text" name="nome" placeholder="Nome Jogador" class="form-control" required>
    <input type="text" name="telefone" placeholder="Telefone" class="form-control" required>
    <button type="submit" class="btn btn-success">Atribuir Cartela</button>
  </form>
</div>

<!-- Lista de Cartelas -->
<div class="mb-4">
  <h3 class="section-title">Cartelas</h3>
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Dono</th>
        <th>Telefone</th>
        <th>Link Cartela</th>
        <th>Prêmio</th>
      </tr>
    </thead>
    <tbody>
      <% cartelas && cartelas.length ? cartelas.forEach(c => { %>
      <tr>
        <td><%= c.id || '-' %></td>
        <td><%= c.dono || '-' %></td>
        <td><%= c.telefone ? c.telefone.replace(/^(\d{2})\d+(\d{3})$/, "$1*****$2") : '-' %></td>
        <td>
          <input type="text" value="<%= 'https://bingo-system.onrender.com/cartela/' + (c.id || '-') %>" readonly class="form-control w-auto d-inline-block">
          <button class="btn btn-secondary btn-copy" data-link="<%= 'https://bingo-system.onrender.com/cartela/' + (c.id || '-') %>">Copiar</button>
        </td>
        <td><%= c.premio || '-' %></td>
      </tr>
      <% }) : '<tr><td colspan="5">Nenhuma cartela cadastrada</td></tr>' %>
    </tbody>
  </table>
</div>

<!-- Vencedores -->
<div class="mb-4">
  <h3 class="section-title">Vencedores</h3>
  <ul>
    <% vencedores && vencedores.length ? vencedores.forEach(v => { %>
      <li class="vencedor-msg">
        Cartela <%= v.id || '-' %> - <%= v.dono || '-' %> | Telefone: <%= v.telefone ? v.telefone.replace(/^(\d{2})\d+(\d{3})$/, "$1*****$2") : '-' %> | Prêmio: <%= v.premio || '-' %>
      </li>
    <% }) : '<li>Nenhum vencedor ainda</li>' %>
  </ul>
</div>

</div>

<script>
const socket = io();

// Botão copiar link
document.querySelectorAll('.btn-copy').forEach(btn => {
    btn.addEventListener('click', () => {
        navigator.clipboard.writeText(btn.dataset.link);
        alert('Link copiado!');
    });
});

// Atualizações em tempo real (opcional)
socket.on('vencedoresAtualizados', vencedores => {
    const ul = document.querySelector('ul');
    ul.innerHTML = '';
    if(vencedores && vencedores.length){
        vencedores.forEach(v => {
            const li = document.createElement('li');
            li.className = 'vencedor-msg';
            li.textContent = `Cartela ${v.id || '-'} - ${v.dono || '-'} | Telefone: ${v.telefone ? v.telefone.replace(/^(\d{2})\\d+(\\d{3})$/, "$1*****$2") : '-'} | Prêmio: ${v.premio || '-'}`;
            ul.appendChild(li);
        });
    } else {
        ul.innerHTML = '<li>Nenhum vencedor ainda</li>';
    }
});
</script>

</body>
</html>
