<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Display - Bingo</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-green-200">
  <div class="p-6 max-w-3xl mx-auto">
    <h1 class="text-3xl text-center mb-4">Display do Bingo</h1>

    <div class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-xl">Último Número</h2>
      <p id="lastNumber" class="text-4xl text-red-600">--</p>
    </div>

    <div class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-xl">Últimos 5 Números</h2>
      <p id="drawnNumbers">--</p>
    </div>

    <div class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-xl">Prêmio Atual</h2>
      <p id="currentPrize"><%= game.currentPrize %></p>
    </div>

    <div id="winnerAlert" class="hidden bg-yellow-200 p-4 rounded shadow">
      <h2 class="text-xl font-bold text-red-600">⚠️ Cartelas vencedoras!</h2>
      <div id="winnerInfo"></div>
    </div>
  </div>

<script>
  const ws = new WebSocket((location.protocol === 'https:' ? 'wss://' : 'ws://') + window.location.host);
  ws.onmessage = e => {
    const data = JSON.parse(e.data);
    if (data.type === 'update') {
      updateUI(data.game, data.winners);
    }
  };

  function updateUI(game, winners) {
    document.getElementById('lastNumber').textContent = game.lastNumber ? getLetterNumber(game.lastNumber) : '--';
    const lastFive = (game.drawnNumbers || []).slice(-5).reverse();
    document.getElementById('drawnNumbers').textContent = lastFive.map(getLetterNumber).join(', ');
    document.getElementById('currentPrize').textContent = game.currentPrize || '--';
    showWinner(winners);
  }

  function getLetterNumber(n) {
    if (n >= 1 && n <= 15) return `B-${n}`;
    if (n <= 30) return `I-${n}`;
    if (n <= 45) return `N-${n}`;
    if (n <= 60) return `G-${n}`;
    if (n <= 75) return `O-${n}`;
    return n;
  }

  function showWinner(winners) {
    const alertBox = document.getElementById('winnerAlert');
    const info = document.getElementById('winnerInfo');
    if (!winners || winners.length === 0) {
      alertBox.classList.add('hidden');
      info.innerHTML = '';
      return;
    }
    alertBox.classList.remove('hidden');
    info.innerHTML = winners.map(w => {
      const masked = w.phoneNumber ? w.phoneNumber.replace(/(\d{2})(\d{5})(\d{4})/, "($1) *****-$3") : '';
      return `<p>Nome: ${w.playerName} | Telefone: ${masked} | Cartela: ${w.cartelaId}</p>`;
    }).join('');
  }
</script>
</body>
</html>
